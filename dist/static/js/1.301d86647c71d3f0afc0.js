webpackJsonp([1],{"3fs2":function(t,e,i){var o=i("RY/4"),a=i("dSzd")("iterator"),l=i("/bQp");t.exports=i("FeBl").getIteratorMethod=function(t){if(void 0!=t)return t[a]||t["@@iterator"]||l[o(t)]}},BO1k:function(t,e,i){t.exports={default:i("fxRn"),__esModule:!0}},"Q/im":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i("BO1k"),a=i.n(o),l=i("ogWm");i.n(l).a.initialize("bd871ea12dc290abce3d439aa8cd12aa","5c7a9c2c9b82387a615d8a674e1ebc78");var n={data:function(){return{tableData:[],limit:5,cur_page:1,multipleSelection:[],del_list:[],editVisible:!1,delVisible:!1,form:{name:"",price:"",objectId:"",url:"",img:"",cateId:0,status:0},options:[],value:"",idx:-1,loading:!0}},created:function(){var t=this;this.loading=!0,setTimeout(this.getData,1e3),Bmob.Query("cates").find().then(function(e){console.info(e),t.options=e})},computed:{},methods:{handleCurrentChange:function(t){this.cur_page=t,this.loading=!0,setTimeout(this.getData,1e3)},changeCategory:function(){this.loading=!0,setTimeout(this.getData,1e3)},getData:function(){var t=this,e=Bmob.Query("products");e.limit(this.limit),e.skip(parseInt(this.cur_page-1)*this.limit),this.value.length>0&&e.equalTo("category","==",this.value),e.find().then(function(e){t.tableData=e,t.loading=!1})},handleEdit:function(t,e){if(e){this.idx=t;var i=this.tableData[t];this.form=i}this.editVisible=!0},handleDelete:function(t,e){this.idx=t,this.delVisible=!0},delAll:function(){for(var t=this.multipleSelection.length,e="",i=0;i<t;i++)e+=this.multipleSelection[i].name+" "+this.multipleSelection[i].objectId+" ",this.deleteRow(this.multipleSelection[i].objectId);this.$message.error("删除了"+e),this.multipleSelection=[]},handleSelectionChange:function(t){console.info(t),this.multipleSelection=t},saveEdit:function(){var t=this,e=this;this.$set(this.tableData,this.idx,this.form);var i=Bmob.Query("products");if(this.tableData[this.idx].objectId){console.info(this.tableData[this.idx].objectId);var o=this.tableData[this.idx].objectId;i.get(o).then(function(t){console.log(t),t.set("name",e.form.name),t.set("price",e.form.price),t.set("category",e.form.category),console.info(e.form.cateId),t.set("cateId",parseInt(e.form.cateId)),t.set("url",e.form.url),t.set("img",e.form.img),t.set("status",parseInt(e.form.status)),t.save()}).catch(function(t){console.log(t)})}else i.set("name",this.form.name),i.set("price",this.form.price),i.set("category",this.form.category),i.set("cateId",parseInt(e.form.cateId)),i.set("url",this.form.url),i.set("img",this.form.img),i.set("status",parseInt(this.form.status)),i.save().then(function(t){console.log(t)}).catch(function(e){console.log(e),t.$message.success(e)});this.editVisible=!1,this.$message.success("修改第 "+(this.idx+1)+" 行成功")},changeCateId:function(t){for(var e in console.info(t),this.options)this.options[e].title===t&&(this.form.cateId=this.options[e].id)},iptChange:function(){console.info(this.form.url);var t=this;t.getBase64Image(t.form.url,void 0,void 0,function(e){e?t.form.img=e:t.$message.success("图片转化失败")})},iptUpload:function(){var t=this,e=document.getElementById("profilePhotoFileUpload"),i=e.files,o=void 0,l=!0,n=!1,s=void 0;try{for(var r,c=a()(i);!(l=(r=c.next()).done);l=!0){var u=r.value;o=Bmob.File(u.name,u)}}catch(t){n=!0,s=t}finally{try{!l&&c.return&&c.return()}finally{if(n)throw s}}o.save().then(function(i){console.info(i[0].url),t.form.url=i[0].url,t.iptChange(),e.setAttribute("data-url",i[0].url)})},deleteRow:function(t){this.tableData.splice(this.idx,1),Bmob.Query("products").destroy(t).then(function(t){console.log(t)}).catch(function(t){console.log(t)}),this.$message.success("删除成功"),this.delVisible=!1},getBase64Image:function(t,e,i,o){var a=new Image;a.onload=function(){var t,l;o&&o((t=document.createElement("canvas"),l=t.getContext("2d"),t.width=e||a.width,t.height=i||a.height,l.drawImage(a,0,0,t.width,t.height),t.toDataURL()))},a.onerror=function(){o&&o(!1)},a.setAttribute("crossOrigin","Anonymous"),a.src=t}}},s={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"table"},[i("div",{staticClass:"crumbs"},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",[i("i",{staticClass:"el-icon-goods"}),t._v(" 商品列表")])],1)],1),t._v(" "),i("div",{staticClass:"container"},[i("div",{staticClass:"select-box"},[i("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:function(e){t.changeCategory()}},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},t._l(t.options,function(t){return i("el-option",{key:t.id,attrs:{label:t.title,value:t.title}})})),t._v(" "),i("el-button",{staticStyle:{margin:"20px"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(e){t.handleEdit()}}},[t._v("添加商品")]),t._v(" "),i("el-button",{staticClass:"handle-del mr10",attrs:{type:"primary",icon:"delete"},on:{click:t.delAll}},[t._v("批量删除")])],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,border:""},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),i("el-table-column",{attrs:{prop:"objectId",label:"objectId",width:"100"}}),t._v(" "),i("el-table-column",{attrs:{prop:"name",label:"商品名",width:"100"}}),t._v(" "),i("el-table-column",{attrs:{label:"图片链接",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v(t._s(e.row.url))])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"图片",width:"150"},scopedSlots:t._u([{key:"default",fn:function(t){return[i("img",{staticStyle:{height:"100px"},attrs:{src:t.row.img,alt:""}})]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"价格",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v("￥"+t._s(e.row.price)+"/天")])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"分类",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",[t._v("category:"+t._s(e.row.category))]),t._v(" "),i("br"),t._v(" "),i("span",[t._v("cateId:"+t._s(e.row.cateId))])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[1==e.row.status?i("span",[t._v("已租")]):i("span",[t._v("未租")])]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"id",label:"商品id",width:"80"}}),t._v(" "),i("el-table-column",{attrs:{prop:"createdAt",label:"创建时间",sortable:"",width:"140"}}),t._v(" "),i("el-table-column",{attrs:{prop:"updatedAt",label:"更新时间",sortable:"",width:"140"}}),t._v(" "),i("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{size:"small"},on:{click:function(i){t.handleEdit(e.$index,e.row)}}},[t._v("编辑")]),t._v(" "),i("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(i){t.handleDelete(e.$index,e.row)}}},[t._v("删除")])]}}])})],1),t._v(" "),i("div",{staticClass:"pagination"},[i("el-pagination",{attrs:{layout:"prev, pager, next",total:1e3},on:{"current-change":t.handleCurrentChange}})],1)],1),t._v(" "),i("el-dialog",{attrs:{title:"编辑",visible:t.editVisible,width:"40%"},on:{"update:visible":function(e){t.editVisible=e}}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"商品名"}},[i("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"图片链接"}},[i("el-input",{on:{change:function(e){t.iptChange()}},model:{value:t.form.url,callback:function(e){t.$set(t.form,"url",e)},expression:"form.url"}}),t._v(" "),i("el-input",{attrs:{type:"file","data-url":t.form.url,id:"profilePhotoFileUpload"},on:{change:function(e){t.iptUpload()}}})],1),t._v(" "),i("el-form-item",{attrs:{label:"价格"}},[i("el-input",{model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"分类"}},[i("el-select",{attrs:{"data-cateid":t.form.cateId,placeholder:"请选择"},on:{change:function(e){t.changeCateId(t.form.category)}},model:{value:t.form.category,callback:function(e){t.$set(t.form,"category",e)},expression:"form.category"}},t._l(t.options,function(t){return i("el-option",{key:t.id,attrs:{label:t.title,value:t.title}})}))],1),t._v(" "),i("el-form-item",{attrs:{label:"状态"}},[i("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[i("el-radio",{attrs:{label:0}}),t._v(" "),i("el-radio",{attrs:{label:1}})],1)],1)],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.editVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.saveEdit}},[t._v("确 定")])],1)],1),t._v(" "),i("el-dialog",{attrs:{title:"提示",visible:t.delVisible,width:"300px",center:""},on:{"update:visible":function(e){t.delVisible=e}}},[i("div",{staticClass:"del-dialog-cnt"},[t._v("删除不可恢复，是否确定删除？")]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.delVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.deleteRow(t.tableData[t.idx].objectId)}}},[t._v("确 定")])],1)])],1)},staticRenderFns:[]};var r=i("VU/8")(n,s,!1,function(t){i("Tqyy")},"data-v-5416b7b7",null);e.default=r.exports},"RY/4":function(t,e,i){var o=i("R9M2"),a=i("dSzd")("toStringTag"),l="Arguments"==o(function(){return arguments}());t.exports=function(t){var e,i,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),a))?i:l?o(e):"Object"==(n=o(e))&&"function"==typeof e.callee?"Arguments":n}},Tqyy:function(t,e){},fxRn:function(t,e,i){i("+tPU"),i("zQR9"),t.exports=i("g8Ux")},g8Ux:function(t,e,i){var o=i("77Pl"),a=i("3fs2");t.exports=i("FeBl").getIterator=function(t){var e=a(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return o(e.call(t))}}});